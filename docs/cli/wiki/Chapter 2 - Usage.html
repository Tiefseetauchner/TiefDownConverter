<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Tiefseetauchner et al." />
  <title>TiefDownConverter Documentation</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="/TiefDownConverter/template/html_template/style.css" />
</head>
<body>
<header>
    <em>Available at <a
            href="https://github.com/Tiefseetauchner/TiefDownConverter">https://github.com/Tiefseetauchner/TiefDownConverter</a></em><br />
    <nav class="nav-container">
        <a href="/TiefDownConverter/">Home</a>
        <a href="/TiefDownConverter/cli/">CLI Docs</a>
        <a href="/TiefDownConverter/lib/">Library Docs</a>
    </nav>
</header>
<header id="title-block-header">
<h1 class="title">TiefDownConverter Documentation</h1>
<p class="author">Tiefseetauchner et al.</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#usage" id="toc-usage">Usage</a>
<ul>
<li><a href="#installation" id="toc-installation">Installation</a></li>
<li><a href="#getting-started" id="toc-getting-started">Getting
started</a></li>
<li><a href="#the-input-directory" id="toc-the-input-directory">The
input “directory”</a></li>
<li><a href="#markdown-projects" id="toc-markdown-projects">Markdown
projects</a></li>
<li><a href="#input-processing" id="toc-input-processing">Input
Processing</a></li>
<li><a href="#customising-the-template"
id="toc-customising-the-template">Customising the template</a></li>
<li><a href="#adjusting-template-behaviour"
id="toc-adjusting-template-behaviour">Adjusting template
behaviour</a></li>
<li><a href="#conversion-profiles"
id="toc-conversion-profiles">Conversion Profiles</a></li>
<li><a href="#writing-templates" id="toc-writing-templates">Writing
templates</a></li>
<li><a href="#shared-metadata" id="toc-shared-metadata">Shared
Metadata</a>
<ul>
<li><a href="#accessing-metadata-in-latex"
id="toc-accessing-metadata-in-latex">Accessing metadata in
LaTeX</a></li>
<li><a href="#accessing-metadata-in-typst"
id="toc-accessing-metadata-in-typst">Accessing metadata in
Typst</a></li>
<li><a href="#using-metadata-for-custom-preprocessors-and-processors"
id="toc-using-metadata-for-custom-preprocessors-and-processors">Using
metadata for custom preprocessors and processors</a></li>
</ul></li>
<li><a href="#epub-support" id="toc-epub-support">Epub Support</a>
<ul>
<li><a href="#customizing-css" id="toc-customizing-css">Customizing
CSS</a></li>
<li><a href="#adding-fonts" id="toc-adding-fonts">Adding Fonts</a></li>
<li><a href="#metadata-and-structure"
id="toc-metadata-and-structure">Metadata and Structure</a></li>
<li><a href="#using-lua-filters" id="toc-using-lua-filters">Using Lua
Filters</a></li>
</ul></li>
<li><a href="#conversion-engines" id="toc-conversion-engines">Conversion
Engines</a>
<ul>
<li><a href="#latex" id="toc-latex">LaTeX</a></li>
<li><a href="#typst" id="toc-typst">Typst</a></li>
<li><a href="#epub" id="toc-epub">EPUB</a></li>
<li><a href="#custom-preprocessors-converter"
id="toc-custom-preprocessors-converter">Custom Preprocessors
Converter</a></li>
<li><a href="#custom-processor-converter"
id="toc-custom-processor-converter">Custom Processor Converter</a></li>
</ul></li>
<li><a href="#writing-filters" id="toc-writing-filters">Writing
filters</a></li>
<li><a href="#preprocessing"
id="toc-preprocessing">Preprocessing</a></li>
<li><a href="#custom-preprocessors-conversion"
id="toc-custom-preprocessors-conversion">Custom Preprocessors
Conversion</a></li>
<li><a href="#custom-processor-arguments"
id="toc-custom-processor-arguments">Custom Processor Arguments</a></li>
<li><a href="#injections" id="toc-injections">Injections</a></li>
<li><a href="#smart-cleaning" id="toc-smart-cleaning">Smart
Cleaning</a></li>
</ul></li>
</ul>
</nav>
<h1 id="usage">Usage</h1>
<p>The basic usage of <code>tiefdownconverter</code> is relatively
simple. The difficult part is understanding the templating system and
how to customise it for your usecases. Presets can only do so much.</p>
<blockquote>
<p>Note: I wrote this paragraph before the big refactor. The basic usage
is no longer simple.</p>
</blockquote>
<h2 id="installation">Installation</h2>
<p>Currently the only way to install <code>tiefdownconverter</code> is
to either build it yourself, install it from cargo, or download a
precompiled binary from the <a
href="https://github.com/tiefseetauchner/tiefdownconverter/releases">releases
page</a>. Then just add it to the path and you’re good to go. You can of
course also just call it relatively by placing the binary in your
project folder or something like that.</p>
<p>If you build from source, run <code>cargo build [--release]</code> or
<code>cargo install --path .</code>.</p>
<p>That said, the recommended way to install TiefDownConverter is
<code>cargo install tiefdownconverter</code>. This will always install
the latest version.</p>
<p>Downloading from the release is as simple as downloading the
appropriate version (Windows, Mac, Linux) and adding it to a folder in
the path. You could also add tiefdownconverter to a folder and run it
from there.</p>
<p>There are a few dependencies that you need to install.</p>
<ul>
<li><a href="https://pandoc.org/">Pandoc</a>: Conversion from Markdown
to TeX, Typst and Epub.</li>
<li>A TeX distribution: For converting TeX files to PDF. It has to
include xelatex.
<ul>
<li>If using <a href="https://www.tug.org/texlive/">TeX Live</a> you may
need to additionally install <code>texlive-xetex</code> depending on
your system.</li>
<li>If using <a href="https://miktex.org/">MikTeX</a>, no need to do
anything.</li>
</ul></li>
<li><a href="https://typst.app/">Typst</a>: For converting Typst files
to PDF.</li>
</ul>
<p>Windows is easy enough:
<code>winget install miktex pandoc typst</code>.</p>
<p>Linux varies by distro of course, but for ubuntu it’s
<code>apt install texlive-xetex pandoc</code> and
<code>cargo install typst</code> or downloading the typst binary and
adding it to the path.</p>
<p>Mac is still to be tested, but MacTex should have XeTeX
installed.</p>
<p>Now you should be able to run <code>tiefdownconverter</code> from the
command line. You can test it by initialising a test project using
<code>tiefdownconverter init testproject</code> and running
<code>tiefdownconverter convert</code> in the project directory or
<code>tiefdownconverter convert -p testproject</code>. You could also,
as a test, clone the <a
href="https://github.com/Tiefseetauchner/TiefDownConverter">Github
Repo</a> and run <code>tiefdownconverter convert -p docs</code>.</p>
<h2 id="getting-started">Getting started</h2>
<p>TL;DR: Make a folder, go into it and run
<code>tiefdownconverter init</code> and
<code>tiefdownconverter convert</code>. That’s it.</p>
<p>Long anser: First off, you need to create a project using
<code>tiefdownconverter init</code>. This will create a new project
<strong>in the current directory</strong>. You can (and maybe should)
specify a project, like
<code>tiefdownconverter init your_project</code>.</p>
<p>This command creates the basic template structure like so:</p>
<pre><code>your_project/
├── Markdown/
│   └── Chapter 1 - Introduction.md
├── template/
│   ├── meta.tex
│   └── template.tex
└── manifest.toml</code></pre>
<p>The Markdown folder contains an example Markdown file. When placing
your markdown files in this folder, make sure they’re named like
<code>... XX ... .md</code>, with anything following the number being
ignored. <em>This is important</em>, as the converter will use this to
sort the files for conversion, as otherwise it’d have no idea in which
order they should be converted. Essentially, the first number you
include must be the number of the file in order, so I suggest using a
pattern like <code>Chapter X.md</code> or <code>X - ... .md</code>.</p>
<p>Now you should be able to run
<code>tiefdownconverter convert -p path/to/your_project</code> (or
ommitting the -p flag if you’re already in the project directory) and it
should generate a PDF file in the project directory using the default
LaTeX template. You can now adjust the template, add your own input
files (Markdown or otherwise), and so on.</p>
<h2 id="the-input-directory">The input “directory”</h2>
<p>Your source files are the main input for the converter, and as such
their structure is important. The converter will look for files in the
<code>Markdown</code> directory (or the directory specified during
project creation) and will sort them by a chapter number. Namely, your
files should be named <code>Whatever X Whatever else.ext</code>, where X
is a number (you don’t have to name them 01, 02 etc., as we parse the
number as an integer, leading zeros are removed). The converter will
then sort them by the first number and combine them in that order
regardless of extension.</p>
<p>You can also add subdirectories in the input directory. These will be
combined after the file with the same number. For example, consider the
following directory structure:</p>
<pre><code>Markdown/
├── Chapter 1 - Introduction.md
├── Chapter 2 - Usage.md
├── Chapter 2 - Usage/
│   ├── Chapter 1 - Usage detail 1.md
│   └── Chapter 2 - Usage detail 2.md
└── Chapter 3 - Customisation.md</code></pre>
<p>The converter will combine the files in the following order:</p>
<ol type="1">
<li>Chapter 1 - Introduction.md</li>
<li>Chapter 2 - Usage.md</li>
<li>Chapter 2 - Usage/Chapter 1 - Usage detail 1.md</li>
<li>Chapter 2 - Usage/Chapter 2 - Usage detail 2.md</li>
<li>Chapter 3 - Customisation.md</li>
</ol>
<p>That is, the converter orders a directory by the same logic as other
files (and even does so recursively), and directories are combined after
the file with the same number.</p>
<p>You can change what directory the converter looks for markdown files
in by changing the <code>markdown_dir</code> field in the manifest.toml
file or saying <code>-m path/to/markdown/dir</code> when initialising
the project.</p>
<h2 id="markdown-projects">Markdown projects</h2>
<p>Now, above is a simplified explanation. If you want the full picture,
read on.</p>
<p>With version 0.8.0 and above, the converter can handle multiple
markdown folders at the same time. This is called a “markdown project”
and it is the most convoluted way to think about markdown directories.
Basically, a TiefDown project can have multiple markdown projects, that
are loaded as described above. But they have additional information
stored in them, importantly <strong>markdown project specific
metadata</strong>.</p>
<p>Now, why does this exist? Well, the basic idea is that you can have
multiple projects per project. Markdown projects per TiefDown project,
that is. It’s useful for books for example, where you may have shared
templates and metadata (like an author) but seperate content and
metadata (like a title) for the different books. This, in theory,
simplifies the workflow substantially - but makes it more complicated to
understand.</p>
<p>First off, the setup. You can run</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project markdown add <span class="op">&lt;</span>PROJECT_NAME<span class="op">&gt;</span> <span class="op">&lt;</span>PATH_TO_MARKDOWN_DIR<span class="op">&gt;</span> <span class="op">&lt;</span>PATH_TO_OUTPUT_DIR<span class="op">&gt;</span></span></code></pre></div>
<p>to add a markdown project to a TiefDown project. Per default, this is
either not set at all, using the default markdown directory and output
directory, or it is set to the default markdown directory and output
directory of the TiefDown project, which are <code>Markdown</code> and
<code>.</code> respectively. Importantly, the output directory is
relevant for the conversion - it is used to seperate the templating for
the different projects, as well as the markdown files. So don’t use the
same output directory for multiple projects unless you hacked TDC to
change the output format to include the template name, in which case,
tell me how you did it.</p>
<p>The output directory is also important as the templates are all saved
to the same file name per default (as in, the template output file
name), and if you didn’t use a different output directory, you’d
overwrite the generated output for the other project. (Unless, as I
said, you found a workaround that doesn’t involve a PR.)</p>
<p>Project specific metadata is interesting as well, as in the end, it
is merged with the shared metadata. So when you run the conversion,
first the shared metadata is loaded and then the markdown project
specific metadata, overwriting the shared metadata.</p>
<p>Setting metadata is done by using the meta command, similarly to the
<a href="#shared-metadata">shared-meta</a> command, except that you have
to specify the markdown project name as well. As an example, you may
run</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project markdown meta <span class="op">&lt;</span>PROJECT_NAME<span class="op">&gt;</span> set <span class="op">&lt;</span>KEY<span class="op">&gt;</span> <span class="op">&lt;</span>VALUE<span class="op">&gt;</span></span></code></pre></div>
<p>to set a metadata value for a markdown project.</p>
<p>You can also assign resources, which are files that are copied to the
compile directory from the markdown project directory <em>and are
ignored during the conversion process</em>. This is done by using the
resource command. For example, if you had multiple books as seperate
markdown projects, you could have a <code>cover.png</code> file for each
book seperately and then use the resource management to copy it to be
able to be used in a template, for example an epub or as the cover of a
PDF. Check out the <a href="#projectmarkdownresources">resources
command</a> for more information.</p>
<p>You can also assign a <a href="#conversion-profiles">profile</a> to a
markdown project which, if I may say so myself as the person who needed
it, is awesome.</p>
<p>Imagine… Well, don’t imagine. Look at this documentation on github.
You can see, there’s a markdown project called <code>cli_markdown</code>
and a markdown project called <code>man_markdown</code>. They both
contain relatively similar but different markdown files but importantly,
they act quite different. One generates the manpage, and one the
documentation you are reading right now. These are two completely
different tasks, so the <code>man_markdown</code> project uses a
differen profile per default.</p>
<p>A default profile is assigned using the
<code>--default-profile</code> flag. This is the profile that will be
used to convert the markdown project <em>by default</em>. That doesn’t
mean you can’t use all templates as you wish, you can always use the
<code>--profile</code> flag to specify a different profile or the
<code>--templates</code> flag to specify a different set of
templates.</p>
<p>The convert command also accepts a list of markdown projects using
the -m flag. The provided templates or profile are then only converted
for the specified markdown projects.</p>
<h2 id="input-processing">Input Processing</h2>
<p>Input processing converts source files into a format your template
includes. This happens via preprocessors. Input files are grouped by
extension, and each group is processed in one shot by the matching
preprocessor (default or custom). The converter concatenates the stdout
of these runs and writes it to the configured combined output file.</p>
<p>By default, LaTeX templates use <code>output.tex</code> and Typst
templates use <code>output.typ</code>. When you assign preprocessors to
a template, you also specify the combined output filename.</p>
<p>Preprocessors can be extension-specific. See <a
href="#preprocessing">Preprocessing</a> for details.</p>
<h2 id="customising-the-template">Customising the template</h2>
<p>The key idea behind tiefdownconverter is that it can handle multiple
templates at the same time. This is done by creating a template file in
the template directory and adding it to the project’s manifest.toml
file.</p>
<p>You could do this manually, if you were so inclined, but using
<code>tiefdownconverter project template &lt;TEMPLATE_NAME&gt; add</code>
is much easier. Check the <a href="#usage-details">Usage Details</a> and
specifically <a href="#projecttemplatesadd">the templates add
command</a> for the usage of this command. But importantly, once you
created the template and added it to the manifest, you will be able to
convert using it.
<code>tiefdownconverter convert -p path/to/your_project --templates &lt;TEMPLATE_NAME&gt;</code>
will convert only the selected template, aiding in debugging.</p>
<p>And now, you’re pretty much free to do whatever you want with the
template. Write tex or typst templates, use custom filters, so on.</p>
<h2 id="adjusting-template-behaviour">Adjusting template behaviour</h2>
<p>You have a few options for editing template behaviour using
<code>tiefdownconverter</code>. You can of course edit the template
files directly, but there are a few more options.</p>
<p>Mainly and most interestingly, lua filters can adjust the behaviour
of the markdown conversion. These are lua scripts that are run by pandoc
before the markdown is converted to tex or typst. You can add lua
filters to a template by either editing the manifest or using
<code>tiefdownconverter project templates &lt;TEMPLATE_NAME&gt; update --add-filters &lt;FILTER_NAME&gt;</code>.
This can be either the path to a lua filter (relative to the project
directory) or a directory containing lua filters. Look up <a
href="#using-lua-filters">Lua Filters</a> for more information</p>
<p>You can also change the name of the exported file by setting the
<code>output</code> option. For example,
<code>tiefdownconverter project templates &lt;TEMPLATE_NAME&gt; update --output &lt;NEW_NAME&gt;</code>.
This will export the template to <code>&lt;NEW_NAME&gt;</code> instead
of the default <code>&lt;TEMPLATE_NAME&gt;.pdf</code>. This field is
required where the output extension isn’t knowable, so for Custom
Preprocessors/Processor conversions.</p>
<p>Similarly, you could change the template file and type, though I
advice against it, as this may break the template. I advice to just add
a new template and remove the old one using
<code>tiefdownconverter project templates &lt;TEMPLATE_NAME&gt; remove</code>.</p>
<h2 id="conversion-profiles">Conversion Profiles</h2>
<p>A conversion profile is a shortcut to defining templates for the
conversion. If you’re dealing with a lot of templates, you may be
considering only converting some at any time - for example, web ready
PDFs vs. print ready PDFs, or only converting a certain size of PDF.</p>
<p>For that, there are conversion profiles which simply are a list of
templates. It’s essentially like saving your –templates arguments.</p>
<p>You can create these profiles with the
<code>project profile add</code> command, setting a name and a comma
seperated list of templates. Removing a profile is also possible with
the <code>project profile remove</code> command.</p>
<p>Running a conversion with a profile is as simple as adding the
<code>--profile</code> flag.</p>
<p>The manifest file contains a section for this, if you desire to
configure them manually:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[profiles]]</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;PDF&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="dt">templates</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;PDF Documentation LaTeX&quot;</span><span class="op">,</span> <span class="st">&quot;PDF Documentation&quot;</span><span class="op">]</span></span></code></pre></div>
<p>Conversion profiles can also be set as a default for a Markdown
Project, which will by default only convert the templates in the profile
when converting that project. That means, when running TDC without a
<code>--templates</code> or <code>--profile</code> argument, it will use
the templates in the assigned profile only.</p>
<h2 id="writing-templates">Writing templates</h2>
<p>Importantly, when you write your own template, you need to include
the content somehow. That somehow is done via
<code>\input{output.tex}</code> or <code>#include "./output.typ"</code>.
This will include the output of the Markdown conversion in your template
file. If you’re using custom preprocessors, you can change the output
file of the conversion. See <a href="#preprocessing">Preprocessing</a>
for more information. For CustomPreprocessors conversion, this is the
output file already, as there is no template file. Should you be using
CustomProcessor conversion, the combined file is AST and not really
usable, so don’t think about it. See <a
href="#custom-processor-converter">custom processor conversion</a> for
more information.</p>
<h2 id="shared-metadata">Shared Metadata</h2>
<p>Metadata is a key part of any project. That’s why TiefDown allows
adding project wide metadata as well as per markdown project metadata
(see <a href="#markdown-projects">Markdown Projects</a>). This makes
sharing metadata not only between templates easier, but even between
projects.</p>
<p>Imagine you want to manage four books. Each of them has a different
author, but the same publisher. You could add the publisher to the
metadata of each project, but that would be a lot of work, especially if
the publisher changes branding. Instead, you can add the publisher to
the shared metadata, and then add the author to the metadata of each
project.</p>
<p>To add metadata to a project, use the
<code>tiefdownconverter project shared-meta set</code> command. This
writes the metadata to the project’s manifest.toml file and when
converting the project, the metadata will be written to respective
metadata files for the template type (e.g. metadata.tex for LaTeX and
metadata.typ for Typst) or be used to replace arguments during the
conversion. You can then import these files in your template and access
the metadata.</p>
<h3 id="accessing-metadata-in-latex">Accessing metadata in LaTeX</h3>
<p>Metadata, per default, is accessed in LaTeX via the
<code>\meta</code> command. This command takes a key and returns the
value of that key. However, accessing undefined values is undefined
behaviour. Be careful to only access metadata that is defined, and
double check, I never know what happens when you access undefined
metadata. It may just throw an error, it may also write random
characters to your document.</p>
<h3 id="accessing-metadata-in-typst">Accessing metadata in Typst</h3>
<p>Much nicer than LaTeX, Typst has a type system! Just import
<code>meta</code> and access the keys on it. Though the linter will
error out if you do this, so you can write your own
<code>metadata.typ</code> in the template directory with placeholder
values.</p>
<h3 id="using-metadata-for-custom-preprocessors-and-processors">Using
metadata for custom preprocessors and processors</h3>
<p>Now, I mentioned argument replacement. Custom preprocessors or
processors may include arguments like <code>{{title}}</code>, which,
during conversion, are replaced with the metadata field
<code>title</code> if available. That means that you can, for example,
use <code>--title {{title}}</code> as an argument to a custom processor
for a CustomProcessor template that converts to HTML to set the title
field of said HTML file. It’s more complicated, but if you know Pandoc,
you know what I mean (I hope).</p>
<h2 id="epub-support">Epub Support</h2>
<p>EPUB support in TiefDownConverter isn’t as fancy as LaTeX or Typst,
but you can still tweak it to look nice. You don’t get full-blown
templates, but you can mess with CSS, fonts, and Lua filters to make it
work how you want. <em>This template type is however somewhat
depricated. It will not be removed but there likely won’t be any new
features added to it.</em></p>
<h3 id="customizing-css">Customizing CSS</h3>
<p>EPUBs use stylesheets to control how everything looks. Any
<code>.css</code> file you drop into
<code>template/my_epub_template/</code> gets automatically loaded.</p>
<p>For example, you can change the font, line height, and margins like
so:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&quot;Noto Serif&quot;</span><span class="op">,</span> <span class="dv">serif</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">line-height</span><span class="ch">:</span> <span class="dv">1.6</span><span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>blockquote {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-style</span><span class="ch">:</span> <span class="dv">italic</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-left</span><span class="ch">:</span> <span class="dv">3</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ccc</span><span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding-left</span><span class="ch">:</span> <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="adding-fonts">Adding Fonts</h3>
<p>Fonts go into <code>template/my_epub_template/fonts/</code>, and
TiefDownConverter will automatically pick them up. To use them, you just
need to reference them properly in your CSS:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">@font-face</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&quot;EB Garamond&quot;</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-style</span><span class="ch">:</span> <span class="dv">normal</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">normal</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">src</span><span class="ch">:</span> <span class="fu">url(</span><span class="st">&quot;../fonts/EBGaramond-Regular.ttf&quot;</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&quot;EB Garamond&quot;</span><span class="op">,</span> <span class="dv">serif</span><span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This is a good time to mention, epub is just a zip file. As such, as
it is generated by pandoc, it has a predefined structure, and you have
to bend to that. Fonts are in a font directory, and stylesheets in a
styles directory. Thus you have to <em>break out</em> of the styles
directory with .. to get to the fonts directory. Keep that in mind, it
took me a while to figure out.</p>
<h3 id="metadata-and-structure">Metadata and Structure</h3>
<p>EPUBs need some basic metadata, which you define in the YAML front
matter of your Markdown files. Stuff like title, author, and language
goes here:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> main</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;My Publication&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> subtitle</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;A tale of loss and partying hard&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">creator</span><span class="kw">:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">role</span><span class="kw">:</span><span class="at"> author</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span><span class="kw">:</span><span class="at"> Your Name</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rights</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Copyright © 2012 Your Name&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div>
<p>You can also do this via the custom processor arguments, adding
metadata as described in the pandoc documentation. For example, to use a
seperate metadata file, you can do this:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project <span class="pp">[</span><span class="ss">PROJECT_NAME</span><span class="pp">]</span> processors add <span class="st">&quot;Metadata for EPUB&quot;</span> <span class="at">--</span> <span class="at">--metadata-file</span> metadata.yaml</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project <span class="pp">[</span><span class="ss">PROJECT_NAME</span><span class="pp">]</span> templates <span class="op">&lt;</span>TEMPLATE_NAME<span class="op">&gt;</span> update <span class="at">--processor</span> <span class="st">&quot;Metadata for EPUB&quot;</span></span></code></pre></div>
<p>This will include the metadata file in the conversion process,
removing the need for the YAML front matter in your Markdown files and
allowing you to use different metadata files for different
templates.</p>
<h3 id="using-lua-filters">Using Lua Filters</h3>
<p>Want to tweak the structure? That’s what Lua filters are for. You can
use them to rename chapters, remove junk, or modify how elements are
processed.</p>
<p>Example: Automatically renaming chapter headers:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Header<span class="op">(</span><span class="va">el</span><span class="op">)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">el</span><span class="op">.</span><span class="va">level</span> <span class="op">==</span> <span class="dv">1</span> <span class="cf">then</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">pandoc</span><span class="op">.</span>Header<span class="op">(</span><span class="va">el</span><span class="op">.</span><span class="va">level</span><span class="op">,</span> <span class="st">&quot;Chapter: &quot;</span> <span class="op">..</span> <span class="va">pandoc</span><span class="op">.</span><span class="va">utils</span><span class="op">.</span>stringify<span class="op">(</span><span class="va">el</span><span class="op">.</span><span class="va">content</span><span class="op">))</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>And that’s it. You get a customized EPUB without having to fight with
the defaults. Enjoy!</p>
<h2 id="conversion-engines">Conversion Engines</h2>
<p>There are currently five ways to convert your files. All of them are
based on the same system. The main difference is the output format and
the program it gets converted with.</p>
<h3 id="latex">LaTeX</h3>
<p>LaTeX is the best supported by TiefDownConverter, with the most
presets. But as TiefDownConverter is a general-purpose Markdown to PDF
converter, the format doesn’t matter. LaTeX provides the highest degree
of customization, making it ideal for structured documents, novels, and
academic papers.</p>
<p>The primary way to interact with LaTeX is through templates. Lua
filters and such are secondary, but an important part of the conversion
process to adjust behavior for different document classes.</p>
<h3 id="typst">Typst</h3>
<p>Typst is another supported engine, offering a more modern alternative
to LaTeX with a simpler syntax and automatic layout adjustments.
TiefDownConverter allows you to specify Typst templates in the project
manifest.</p>
<p>Typst templates work similarly to LaTeX templates but are easier to
modify if you need structured documents without deep LaTeX
knowledge.</p>
<p>As far as I could tell, typst templates are also far more adherent to
the general typst syntax, so Lua filters are not as important. But they
can still be used to adjust the output, especially for more advanced use
cases.</p>
<h3 id="epub">EPUB</h3>
<p>TiefDownConverter also supports EPUB conversion, making it suitable
for e-book generation. The conversion process uses Pandoc to transform
the Markdown content into EPUB, applying any Lua filters defined in the
manifest.</p>
<p>This however does not really support much in the way of templating.
Customization should be done primarily via Lua filters.</p>
<p>However, you can still get some customization by including CSS and
font files in your template folder. That’s the reason epub has to have a
folder in the first place, so you can place CSS and font files in there.
Of course you can add multiple epub templates, but I don’t know why you
would want to.</p>
<p>EPUB output is particularly useful for digital publishing, ensuring
compatibility with e-readers and mobile devices.</p>
<h3 id="custom-preprocessors-converter">Custom Preprocessors
Converter</h3>
<p>Okay. Stick with me here. The idea is, you are already converting my
input files with Pandoc, why not let me convert them to whatever format?
Well, this is where Custom Preprocessors Conversion comes in. This long
fabled feature is the most complicated one, and you need a deep
understanding of how TiefDownConverter works and at least the ability to
read Pandoc’s documentation to even use it. But if you’re willing to put
in the effort, you can do some pretty cool things.</p>
<p>The basic idea is, just, let the user decide what pandoc does. The
result is chaos.</p>
<p>I’m being facetious, but this is actually the most powerful way to
customize the output. You add one or multiple preprocessors as described
in <a href="#preprocessing">Preprocessing</a> and set the output path of
the preprocessor and template to the same path. Then you can do whatever
pandoc allows. Want to convert to RTF? No issue. But beware: you need to
actually understand what’s going on, otherwise you’ll end up in
implementation hell.</p>
<p>One important thing to keep in mind is to never, ever, try to
generate a non-concatenateable format (like docx, pdf, …) with
CustomPreprocessors conversion. It won’t work as soon as you have more
than one input format. Use <a href="#custom-processor-converter">custom
processor conversion</a> instead.</p>
<h3 id="custom-processor-converter">Custom Processor Converter</h3>
<p>If that wasn’t bad enough: We’ve got more. Custom Processor
Conversions are a way to combine multiple input files to a file type
that isn’t just a collection of lines. For example, take a docx file. It
isn’t just multiple simpler files strung together, it is a complicated
web of zip files and openxml and all that jazz.</p>
<p>Now, why may that be an issue? Simply put: multiple input formats are
converted in batches and strung together when using a custom
preprocessor converter. Instead, we need to convert all output formats
to a common type and merge them afterwards for the conversion to a docx
to work.</p>
<p>That’s what custom processor conversion is for. It uses preprocessors
to convert all input files to a common format (Pandoc native AST) and
combines these files to arrive at a single AST file, letting pandoc then
convert to the required format using a custom processor.</p>
<p>Custom processors require an output file compatible with pandoc. When
creating such a template, make sure to reference the pandoc guide. You
can use custom preprocessors as usual, but you will need to set the
output format flag (<code>-t</code>) to <code>native</code>. A custom
processor can also be used when converting from AST to the output
format. Any pandoc parameter is accepted, but the <code>-o</code> and
<code>-f</code> flags are set at compile time and mustn’t be added.</p>
<h2 id="writing-filters">Writing filters</h2>
<blockquote>
<p><strong>Note:</strong> This section only really addresses LaTeX, but
the concepts are the same for Typst and epub.</p>
</blockquote>
<p>If you are in the business of writing filters (and don’t just solve
everything in TeX itself), I advice checking out the documentation at <a
href="https://pandoc.org/lua-filters.html">https://pandoc.org/lua-filters.html</a>.
But here’s a quick rundown of what you can do. For example, if you
wanted to change the font of all block quotes, there’s a few things
you’d need to do. First off, in your template, you will need to define a
font. It could look something like this:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode tex"><code class="sourceCode latex"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">\usepackage</span>{<span class="ex">fontspec</span>}</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\newfontfamily\blockquotefont</span>{Noto Sans}</span></code></pre></div>
<p>Then, add a filter to your template as described above. The filter
could look something like this:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> BlockQuote<span class="op">(</span><span class="va">el</span><span class="op">)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">tt_start</span> <span class="op">=</span> <span class="va">pandoc</span><span class="op">.</span>RawBlock<span class="op">(</span><span class="st">&#39;latex&#39;</span><span class="op">,</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">blockquotefont</span><span class="sc">\\</span><span class="st">small&#39;</span><span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table.insert</span><span class="op">(</span><span class="va">el</span><span class="op">.</span><span class="va">content</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="va">tt_start</span><span class="op">)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">el</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Of course, you could just redefine the font in TeX but I think this
is a bit more flexible. One usecase that is quite important is to change
the way chapters are handled for LiX. In case of LiX, they expect
<code>\h{chapter_name}</code> instead of <code>\section</code>, which is
the standard behaviour of pandoc. So when you create a LiX backed
template, you have to add a filter to change that behaviour. Something
like this:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Header<span class="op">(</span><span class="va">elem</span><span class="op">)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">elem</span><span class="op">.</span><span class="va">level</span> <span class="op">==</span> <span class="dv">1</span> <span class="cf">then</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">pandoc</span><span class="op">.</span>RawBlock<span class="op">(</span><span class="st">&quot;latex&quot;</span><span class="op">,</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">h{&quot;</span> <span class="op">..</span> <span class="va">pandoc</span><span class="op">.</span><span class="va">utils</span><span class="op">.</span>stringify<span class="op">(</span><span class="va">elem</span><span class="op">.</span><span class="va">content</span><span class="op">)</span> <span class="op">..</span> <span class="st">&quot;}&quot;</span><span class="op">)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">elem</span><span class="op">.</span><span class="va">level</span> <span class="op">==</span> <span class="dv">2</span> <span class="cf">then</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">pandoc</span><span class="op">.</span>RawBlock<span class="op">(</span><span class="st">&quot;latex&quot;</span><span class="op">,</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">hh{&quot;</span> <span class="op">..</span> <span class="va">pandoc</span><span class="op">.</span><span class="va">utils</span><span class="op">.</span>stringify<span class="op">(</span><span class="va">elem</span><span class="op">.</span><span class="va">content</span><span class="op">)</span> <span class="op">..</span> <span class="st">&quot;}&quot;</span><span class="op">)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- add more levels here if needed</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h2 id="preprocessing">Preprocessing</h2>
<p>A “Preprocessor” is a stupid word for defining your own pandoc
conversion parameters. You can (and should) use this to adjust the
behaviour of the converter. For example, you could define a preprocessor
to add <code>--listings</code> to the pandoc command. This is useful if
you want to have reasonable code output in your pdf.</p>
<p>If no preprocessor is defined, the converter will use default pandoc
parameters, converting to the intermediate output file (in case of
LaTeX, this is <code>output.tex</code>). But if you, and this is a
purely hypothetical scenareo, want to run a conversion on mixed input md
and typ files, you can define a typst specific preprocessor that simply
uses cat.</p>
<p>If you want to define a preprocessor, you can do so by running</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project templates <span class="op">&lt;</span>TEMPLATE_NAME<span class="op">&gt;</span> update <span class="dt">\</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--preprocessors</span> <span class="op">&lt;</span>PREPROCESSOR_NAMES,...<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--preprocessor-output</span> <span class="op">&lt;</span>PREPROCESSOR_OUTPUT<span class="op">&gt;</span></span></code></pre></div>
<p>to assign it to a template and</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project pre-processors add <span class="op">&lt;</span>PREPROCESSOR_NAME<span class="op">&gt;</span> -- <span class="pp">[</span><span class="ss">CLI_ARGS</span><span class="pp">]</span></span></code></pre></div>
<p>to create a new preprocessor.</p>
<p>For example, if you want to add <code>--listings</code> to the pandoc
command, you could do so by adding <code>--listings</code> to the
preprocessor. But importantly, <strong>this overwrites the default
preprocessor</strong>. Defaults from that (as few as they may be) won’t
get carried over to the conversion.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project pre-processors add <span class="st">&quot;Enable Listings&quot;</span> <span class="at">--</span> <span class="at">--listings</span></span></code></pre></div>
<p>The manifest would look something like this:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">[[custom_processors.preprocessors]]</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;Enable Listings&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="dt">cli_args</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;--listings&quot;</span><span class="op">]</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="kw">[[templates]]</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="dt">filters</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;luafilters/chapter_filter.lua&quot;</span><span class="op">]</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;PDF Documentation LaTeX&quot;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="dt">output</span> <span class="op">=</span> <span class="st">&quot;docs_tex.pdf&quot;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="dt">template_file</span> <span class="op">=</span> <span class="st">&quot;docs.tex&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="dt">template_type</span> <span class="op">=</span> <span class="st">&quot;Tex&quot;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="kw">[templates.preprocessors]</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="dt">preprocessors</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;Enable Listings&quot;</span><span class="op">]</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="dt">combined_output</span> <span class="op">=</span> <span class="st">&quot;output.tex&quot;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span></code></pre></div>
<p>Now, you may be able to spot a neato featureo: preprocessors are
assigned in an array. That means, you can have multiple preprocessors
per template. With this power however comes the responsibility to define
extension filters on your preprocessors. This is an extension-only glob
pattern set via the <code>--filter</code> option when creating the
preprocessor.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project pre-processors add <span class="st">&quot;No typst conversion&quot;</span> <span class="at">--filter</span> <span class="st">&quot;typ&quot;</span> <span class="at">--cli</span> <span class="st">&quot;cat&quot;</span></span></code></pre></div>
<p>If no filter is provided, the preprocessor applies to all files. In
your template, you can then define the preprocessor list as well as the
combined output of the preprocessor. This is important, as this output
is then passed to the conversion engine (or copied for <a
href="#custom-preprocessors-conversion">Custom Preprocessors
Conversion</a>).</p>
<h2 id="custom-preprocessors-conversion">Custom Preprocessors
Conversion</h2>
<p>I already hinted at it in <a
href="#custom-preprocessors-converter">Custom Preprocessors
Converter</a>, but I’ll go into more detail here. The idea is to run a
preprocessor and just skip any further processing. Straight from pandoc
to the output.</p>
<p>You can do this by first defining a preprocessor, for example:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project pre-processors add <span class="st">&quot;RTF Preprocessor&quot;</span> <span class="at">--</span> <span class="at">-t</span> rtf</span></code></pre></div>
<p>As you can see, we’re outputting as an RTF file. This means we need
to add a template that deals with the same output:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project template <span class="st">&quot;RTF Template&quot;</span> add <span class="at">-o</span> documentation.rtf <span class="at">-t</span> custompandoc</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project template <span class="st">&quot;RTF Template&quot;</span> update <span class="at">--preprocessors</span> <span class="st">&quot;RTF Preprocessor&quot;</span> <span class="at">--preprocessor-output</span> <span class="st">&quot;documentation.rtf&quot;</span></span></code></pre></div>
<p>And that’s it. TiefDownConverter will run the preprocessor, which
outputs to documentation.rtf, and then the templating system will copy
that output to your directory. Hopefully. Did I mention that this is
experimental? Yeah, so if you have issues, please report them. Even if
you’re thinking “this is not a bug, it’s a feature”. It likely
isn’t.</p>
<h2 id="custom-processor-arguments">Custom Processor Arguments</h2>
<p>You can define custom arguments for your processors. These are passed
to the processor, so xelatex, typst, so on, on compilation. For example,
if you needed to add a font directory to your typst conversion, you
could do so by adding the following to your manifest:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">[[custom_processors.processors]]</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;Typst Font Directory&quot;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="dt">processor_args</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;--font-path&quot;</span><span class="op">,</span> <span class="st">&quot;fonts/&quot;</span><span class="op">]</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">[[templates]]</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;PDF Documentation&quot;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dt">output</span> <span class="op">=</span> <span class="st">&quot;docs.pdf&quot;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="dt">processor</span> <span class="op">=</span> <span class="st">&quot;Typst Font Directory&quot;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="dt">template_file</span> <span class="op">=</span> <span class="st">&quot;docs.typ&quot;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="dt">template_type</span> <span class="op">=</span> <span class="st">&quot;Typst&quot;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span></code></pre></div>
<p>Or… Just use the command to create it.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project processor <span class="st">&quot;Typst Font Directory&quot;</span> add <span class="at">--</span> <span class="at">--font-path</span> fonts/</span></code></pre></div>
<p>Then append it to a template.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project template <span class="st">&quot;PDF Documentation&quot;</span> update <span class="at">--processor</span> <span class="st">&quot;Typst Font Directory&quot;</span></span></code></pre></div>
<p>This is especially useful with <a
href="#custom-processor-converter">custom processor converters</a>.</p>
<h2 id="injections">Injections</h2>
<p>Injections are a simple way to manipulate a preprocessing step on a
per template basis without having to mess with preprocessors. An
injection contains files, which are inserted before the preprocessing
step. As such, the rules of the preprocessor apply, including file name
scoped rules.</p>
<p>Injections are defined once in a project and then reused per
template. The template also decides where in the document the injection
is placed. There are three ways a file can be injected into the
document:</p>
<ul>
<li>Header injections get applied at the top of the document and are
rendered as the first files in a conversion.</li>
<li>Body injections are inserted in the document in accordance with the
default sorting rule, and are thus mixed in.</li>
<li>Footer injections are treated equivalently to header injections, but
are instead placed at the end of the conversion list.</li>
</ul>
<p>For example, setting a different chapter 3 per template is made
possible by making a file like <code>3 - injection_pdf.md</code> and
<code>3 - injection_epub.md</code> and add the injections to the
corresponding documents.</p>
<p>A header could be used for a seperate index conversion, allowing you
to define a different header for different output formats. Footers
function similarly.</p>
<p>An injection can be added using the <code>project injections</code>
command:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project injections create <span class="st">&quot;HTML Footer&quot;</span> html_footer.html</span></code></pre></div>
<p>You can then add an injection to an existing template using the
<code>--header-injections</code>, <code>--body-injections</code> and
<code>--footer-injections</code> flags respectively.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tiefdownconverter</span> project template <span class="st">&quot;HTML Documentation&quot;</span> update <span class="at">--footer-injections</span> <span class="st">&quot;HTML Footer&quot;</span></span></code></pre></div>
<p>Keep in mind each category can contain multiple injections.</p>
<h2 id="smart-cleaning">Smart Cleaning</h2>
<p>Smart cleaning is a feature that is relatively simple. If you enable
it in your manifest, it will automatically remove stale or old
conversion directories.</p>
<p>Enable it with the <code>--smart-clean</code> and set the threshold
with <code>--smart-clean-threshold</code>. The threshold is 5 by
default.</p>
<p>You can also manually trigger a smart clean with
<code>tiefdownconverter project smart-clean</code> or a normal clean
with <code>tiefdownconverter project clean</code>. The latter will
remove all conversion directories, while the former will only remove the
ones that are older than the threshold.</p>
</body>
</html>
